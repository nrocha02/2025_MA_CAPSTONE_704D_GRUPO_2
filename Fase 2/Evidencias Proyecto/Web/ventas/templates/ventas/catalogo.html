{% load static %}

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo - {{ categoria }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
  </head>
  <body>

<!-- Barra superior -->
    <div class="bg-primary text-white text-center p-1">
      <small>Despachos gratis por compras sobre $50.000 dentro de Santiago</small>
    </div>

<!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
      <div class="container">
        <img src="{% static 'blog/images/inicio/logo.png'%}" style="width:100px; height:auto; float:left; margin-right:10px;"  alt="logo">
        <a class="navbar-brand fw-bold" href="#">🐾 Cordillera Pets</a>
        <form class="d-flex mx-auto w-50">
          <input class="form-control me-2" type="search" placeholder="Busca tu producto favorito">
          <button class="btn btn-outline-primary">🔍</button>
        </form>
        <div>
          <a href="#" class="btn btn-outline-dark me-2">Inicia sesión</a>
          <a href="{% url 'carrito' %}" class="btn btn-primary">🛒 Carrito</a>
        </div>
      </div>
    </nav>

<!-- Categorías -->
    <div class="bg-white border-top border-bottom">
      <div class="container d-flex justify-content-center py-2">
        <a href="perro" class="mx-3 text-decoration-none fw-bold">Perro</a>
        <a href="gato" class="mx-3 text-decoration-none fw-bold">Gato</a>
        <a href="#" class="mx-3 text-decoration-none fw-bold">Arenas Sanitarias</a>
        <a href="#" class="mx-3 text-decoration-none fw-bold">Nosotros</a>
        <a href="#" class="mx-3 text-decoration-none fw-bold">Contáctanos</a>
      </div>
    </div>

<!----- Migas de pan -
<div class="container mt-3">
  <small><a href="/">Home</a> / {{ categoria }}</small>
</div

 Imagen destacada estilo banner largo -->
    <div style="width: 100%; max-width: 1200px; margin: 20px auto; border-radius: 15px; overflow: hidden; box-shadow: 0 8px 20px rgba(0,0,0,0.3);">
      <img src="{% static 'blog/images/catalogo/catalogo1.png' %}"
           alt="Promoción"
           style="width: 100%; height: 400px; object-fit: cover; display: block;">
    </div>


<!-- Subcategorías -->
    <div class="container text-center my-5">
      <h4>¡Encuentra lo mejor para tu mascota {{ categoria|lower }}!</h4>
      <div class="row justify-content-center mt-4">
        <div class="col-6 col-md-3 mb-3">
        </div>
      </div>

<!-- Marcas como botones -->
      <div class="container my-4">
        <div class="d-flex justify-content-center flex-wrap">

          <div>
            <a href="" class="m-3"
               style="width:150px; height:150px; border-radius:50%; overflow:hidden;
                      box-shadow:0 4px 10px rgba(0,0,0,0.2); display:block;">
              <img src="{% static 'blog/images/catalogo/alimento1.png' %}" alt=""
                   style="width:100%; height:100%; object-fit:cover;">
            </a>
            <p style="margin-top:10px; font-weight:bold;">Alimento Perro</p>
          </div>

          <div><a href="" class="m-3"
                  style="width:150px; height:150px; border-radius:50%; overflow:hidden;
                         box-shadow:0 4px 10px rgba(0,0,0,0.2); display:block;">
            <img src="{% static 'blog/images/catalogo/gato.png' %}" alt=""
                 style="width:100%; height:100%; object-fit:cover;">
          </a>
            <p style="margin-top:10px; font-weight:bold;">Alimento Gato</p>
          </div>

          <div>
            <a href="" class="m-3"
               style="width:150px; height:150px; border-radius:50%; overflow:hidden;
                      box-shadow:0 4px 10px rgba(0,0,0,0.2); display:block;">
              <img src="{% static 'blog/images/catalogo/arena.png' %}" alt=""
                   style="width:100%; height:100%; object-fit:cover;">
            </a>
            <p style="margin-top:10px; font-weight:bold;">Arena Sanitaria</p>
          </div>

          <div>
            <a href="" class="m-3"
               style="width:150px; height:150px; border-radius:50%; overflow:hidden;
                      box-shadow:0 4px 10px rgba(0,0,0,0.2); display:block;">
              <img src="{% static 'blog/images/catalogo/juguete1.png' %}" alt=""
                   style="width:100%; height:100%; object-fit:cover;">
            </a>
            <p style="margin-top:10px; font-weight:bold;">Juguetes & Accesorio</p>
          </div>
        </div>
      </div>



<!-- Filtros -->
      <div class="container my-4">
        <div class="row">
          <div class="col-md-12">
            <form method="GET" class="d-flex flex-wrap gap-2">
              <select name="categoria" class="form-select" style="width: auto;">
                <option value="">Todas las categorías</option>
                {% for categoria in categorias %}
                  <option value="{{ categoria.categoria_id }}"
                          {% if categoria_seleccionada == categoria.categoria_id|stringformat:"s" %}selected{% endif %}>
                    {{ categoria.nombre }}
                  </option>
                {% endfor %}
              </select>
              <select name="marca" class="form-select" style="width: auto;">
                <option value="">Todas las marcas</option>
                {% for marca in marcas %}
                  <option value="{{ marca.marca_id }}"
                          {% if marca_seleccionada == marca.marca_id|stringformat:"s" %}selected{% endif %}>
                    {{ marca.nombre }}
                  </option>
                {% endfor %}
              </select>
              <button type="submit" class="btn btn-primary">Filtrar</button>
              <a href="{% url 'catalogo' %}" class="btn btn-outline-secondary">Limpiar filtros</a>
            </form>
          </div>
        </div>
      </div>

<!--Catalogo con productos dinámicos-->
      <section id="portafolio" class="portfolio section-padding">
        <div class="container">
          <div class="row">
            <div class="col-md-12">
              <div class="section-header text-center pb-5">
                <h4>Productos disponibles ({{ productos|length }})</h4>
              </div>
            </div>
          </div>
          <div class="row">
            {% for producto in productos %}
              <div class="col-12 col-md-6 col-lg-3 mb-4">
                <div class="card text-center bg-white pb-2 h-100">
                  <div class="card-body text-dark">
                    <div class="img-area mb-4">
                      {% if producto.imagen_url %}
                        <img src="{% static producto.imagen_url %}" alt="{{ producto.nombre }}" width="200" height="200" style="object-fit: cover;">
                      {% else %}
                        <div class="d-flex align-items-center justify-content-center bg-light" style="width: 200px; height: 200px; margin: 0 auto;">
                          <span class="text-muted">Sin imagen</span>
                        </div>
                      {% endif %}
                    </div>
                    <h5 class="card-title">{{ producto.nombre }}</h5>
                    <p class="text-muted small">{{ producto.marca.nombre|default:"Sin marca" }}</p>
                    <p class="lead" style="font-size: small;">
                      {{ producto.descripcion|truncatewords:25|default:"Descripción no disponible" }}
                      <br><br>
                      <strong>SKU:</strong> {{ producto.sku }}<br>
                      <strong>Stock:</strong> {{ producto.stock }} unidades<br>
                      <strong>Precio: ${{ producto.precio|floatformat:0 }}</strong>
                    </p>
                    <div class="mt-auto">
                      <a href="{% url 'producto_detalle' producto.producto_id %}" class="btn btn-outline-primary btn-sm me-2">Ver detalle</a>
                      {% if producto.stock > 0 %}
                        <button type="button" class="btn btn-success btn-sm" onclick="agregarAlCarrito({{ producto.producto_id }})">Añadir al Carrito</button>
                      {% else %}
                        <button type="button" class="btn btn-secondary btn-sm" disabled>Sin stock</button>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            {% empty %}
              <div class="col-12 text-center">
                <div class="alert alert-info">
                  <h5>No hay productos disponibles</h5>
                  <p>No se encontraron productos que coincidan con los filtros seleccionados.</p>
                  <a href="{% url 'catalogo' %}" class="btn btn-primary">Ver todos los productos</a>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </section>

<!-- Script para agregar al carrito -->
      <script>
        function agregarAlCarrito(productoId) {
    // Aquí puedes implementar la lógica AJAX para agregar al carrito
    // Por ahora, redirigimos al carrito con el ID del producto
          window.location.href = "{% url 'carrito' %}?add=" + productoId;
        }
      </script>



<!-- Productos destacados -->
      {% if productos %}
        <div class="container my-5">
          <h4 class="fw-bold">Productos destacados</h4>
          <div class="row">
            {% for producto in productos|slice:":4" %}
              <div class="col-6 col-md-3 mb-3">
                <div class="card shadow-sm h-100">
                  {% if producto.imagen_url %}
                    <img src="{% static producto.imagen_url %}" class="card-img-top" alt="{{ producto.nombre }}" style="height: 150px; object-fit: cover;">
                  {% else %}
                    <div class="card-img-top d-flex align-items-center justify-content-center bg-light" style="height: 150px;">
                      <span class="text-muted">Sin imagen</span>
                    </div>
                  {% endif %}
                  <div class="card-body text-center">
                    <h6 class="card-title">{{ producto.nombre|truncatechars:30 }}</h6>
                    <p class="text-primary fw-bold">${{ producto.precio|floatformat:0 }}</p>
                    <a href="{% url 'producto_detalle' producto.producto_id %}" class="btn btn-sm btn-outline-primary me-1">Ver</a>
                    <a href="{% url 'carrito' %}?add={{ producto.producto_id }}" class="btn btn-sm btn-success">Agregar</a>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endif %}

<!-- Footer -->
      <footer class="bg-light border-top mt-5 py-4">
        <div class="container d-flex flex-wrap justify-content-between">
          <div>
            <h6>Productos</h6>
            <a href="#" class="d-block text-muted">Perros</a>
            <a href="#" class="d-block text-muted">Gatos</a>
            <a href="#" class="d-block text-muted">Arenas Sanitarias</a>
          </div>
          <div>
            <h6>Mi cuenta</h6>
            <a href="#" class="d-block text-muted">Entrar a mi cuenta</a>
            <a href="#" class="d-block text-muted">Mis pedidos</a>
          </div>
          <div>
            <h6>Nosotros</h6>
            <a href="#" class="d-block text-muted">Quiénes somos</a>
            <a href="#" class="d-block text-muted">Trabaja con nosotros</a>
            <a href="#" class="d-block text-muted">Términos y condiciones</a>
          </div>
          <div>
            <h6>Contacto</h6>
            <p class="text-muted mb-1">📧 ventas@cordillerapets.cl</p>
            <p class="text-muted mb-1">📞 +56999999999</p>
            <p class="text-muted">📲 WhatsApp: +56999999999</p>
          </div>
        </div>
        <div class="text-center mt-3">
          <small class="text-muted">© 2025 Cordillera Pets - Todos los derechos reservados</small>
        </div>
      </footer>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    </body>
  </html>
