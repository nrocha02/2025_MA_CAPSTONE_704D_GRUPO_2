{% load static %}

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ titulo }} - Cordillera Pets</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
        <a class="navbar-brand" href="{% url 'dashboard:admin_dashboard' %}">
          <i class="fas fa-cog"></i> Admin Cordillera Pets
        </a>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item">
              <a
                href="{% url 'dashboard:admin_dashboard' %}"
                class="text-white-50"
              >Dashboard</a
                >
              </li>
              <li class="breadcrumb-item active text-white">{{ titulo }}</li>
            </ol>
          </nav>
        </div>
      </nav>

      <div class="container mt-4">
      <!-- Encabezado -->
        <div class="row mb-4">
          <div class="col-md-8">
            <h1 class="h3">{{ titulo }}</h1>
            <p class="text-muted">Administra las categorías de productos</p>
          </div>
          <div class="col-md-4 text-end">
            <a
              href="{% url 'dashboard:categoria_create' %}"
              class="btn btn-success"
            >
              <i class="fas fa-plus"></i> Nueva Categoría
            </a>
          </div>
        </div>

      <!-- Mensajes -->
        {% if messages %} {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
            {{ message }}
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
            ></button>
          </div>
        {% endfor %}
        {% endif %}

      <!-- Tabla de categorías -->
        <div class="card">
          <div class="card-body">
            {% if categorias %}
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th style="width: 7%">ID</th>
                      <th style="width: 20%">Nombre</th>
                      <th style="width: 8%">Nivel</th>
                      <th style="width: 13%">Categoría Padre</th>
                      <th style="width: 22%">Descripción</th>
                      <th style="width: 8%">Productos</th>
                      <th style="width: 10%">Estado</th>
                      <th style="width: 12%">Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for categoria in categorias %}
                      <tr>
                        <td>
                          <span class="badge bg-light text-dark"
                          >{{ categoria.categoria_id }}</span
                            >
                          </td>
                          <td>
                            {% if categoria.nivel == 2 %}
                              <div class="ms-3">
                                <i class="fas fa-arrow-right text-muted me-2"></i>
                                <strong>{{ categoria.nombre }}</strong>
                              </div>
                            {% else %}
                              <strong class="text-primary">{{ categoria.nombre }}</strong>
                            {% endif %}
                          </td>
                          <td>
                            <span
                              class="badge bg-{% if categoria.nivel == 1 %}primary{% else %}secondary{% endif %}"
                            >
                              Nivel {{ categoria.nivel }}
                            </span>
                          </td>
                          <td>
                            {% if categoria.categoria_padre %}
                              <span class="badge bg-info"
                              >{{ categoria.categoria_padre.nombre }}</span
                                >
                            {% else %}
                              <span class="text-muted">—</span>
                            {% endif %}
                          </td>
                          <td>
                            {% if categoria.descripcion %}
                              <span class="text-muted"
                              >{{ categoria.descripcion|truncatechars:60 }}</span
                                >
                            {% else %}
                              <small class="text-muted fst-italic">Sin descripción</small>
                            {% endif %}
                          </td>
                          <td class="text-center">
                            <span class="badge bg-secondary"
                            >{{ categoria.productos_count }}</span
                              >
                            </td>
                            <td>
                              {% if categoria.activa %}
                                <span class="badge bg-success">Activa</span>
                              {% else %}
                                <span class="badge bg-danger">Inactiva</span>
                              {% endif %}
                            </td>
                            <td>
                              <div class="btn-group btn-group-sm">
                                <a
                                  href="{% url 'dashboard:categoria_edit' categoria.categoria_id %}"
                                  class="btn btn-outline-primary"
                                  title="Editar"
                                >
                                  <i class="fas fa-edit"></i>
                                </a>
                                <a
                                  href="{% url 'dashboard:categoria_delete' categoria.categoria_id %}"
                                  class="btn btn-outline-danger"
                                  title="Eliminar"
                                >
                                  <i class="fas fa-trash"></i>
                                </a>
                              </div>
                            </td>
                          </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>

          <!-- Paginación -->
              {% if categorias.has_other_pages %}
                <nav class="mt-3">
                  <ul class="pagination justify-content-center">
                    {% if categorias.has_previous %}
                      <li class="page-item">
                        <a
                          class="page-link"
                          href="?page={{ categorias.previous_page_number }}"
                        >
                          <i class="fas fa-chevron-left"></i> Anterior
                        </a>
                      </li>
                    {% endif %}
                    {% for num in categorias.paginator.page_range %}
                      {% if categorias.number == num %}
                        <li class="page-item active">
                          <span class="page-link">{{ num }}</span>
                        </li>
                        {% elif num > categorias.number|add:'-3' and num <
                        categorias.number|add:'3' %}
                        <li class="page-item">
                          <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                        </li>
                      {% endif %}
                    {% endfor %}
                    {% if categorias.has_next %}
                      <li class="page-item">
                        <a
                          class="page-link"
                          href="?page={{ categorias.next_page_number }}"
                        >
                          Siguiente <i class="fas fa-chevron-right"></i>
                        </a>
                      </li>
                    {% endif %}
                  </ul>
                </nav>
              {% endif %}
            {% else %}
              <div class="text-center py-5">
                <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                <h5 class="text-muted">No hay categorías registradas</h5>
                <p class="text-muted">Comienza creando tu primera categoría</p>
                <a
                  href="{% url 'dashboard:categoria_create' %}"
                  class="btn btn-success"
                >
                  <i class="fas fa-plus"></i> Crear Primera Categoría
                </a>
              </div>
            {% endif %}
          </div>
        </div>

      <!-- Información adicional -->
        <div class="row mt-4">
          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <h6 class="card-title">
                  <i class="fas fa-chart-bar text-primary"></i> Estadísticas
                </h6>
                <ul class="list-unstyled mb-0">
                  <li class="mb-1">
                    <i class="fas fa-layer-group text-muted me-2"></i>
                    <strong>Total de categorías:</strong>
                    {{ categorias.paginator.count|default:0 }}
                  </li>
                  <li class="mb-1">
                    <i class="fas fa-sitemap text-muted me-2"></i>
                    <strong>En esta página:</strong>
                    {{ categorias.object_list|length }}
                  </li>
                  <li class="mb-1">
                    <i class="fas fa-tags text-warning me-2"></i>
                    <strong>Página actual:</strong> {{ categorias.number }} de {{ categorias.paginator.num_pages }}
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <h6 class="card-title">Acciones rápidas</h6>
                <div class="d-grid gap-2">
                  <a
                    href="{% url 'dashboard:admin_dashboard' %}"
                    class="btn btn-outline-secondary btn-sm"
                  >
                    <i class="fas fa-arrow-left"></i> Volver al Dashboard
                  </a>
                  <a
                    href="{% url 'dashboard:producto_list' %}"
                    class="btn btn-outline-primary btn-sm"
                  >
                    <i class="fas fa-boxes"></i> Ver Productos
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    </body>
  </html>
