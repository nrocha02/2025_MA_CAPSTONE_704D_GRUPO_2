{% extends "ventas/ventas_base.html" %}
{% load static %}

{% block title %}{{ producto.nombre }} - Cordillera Pets{% endblock %}

{% block content %}

    <!-- Migas de pan -->
  <div class="container mt-3">
    <small>
      <a href="{% url 'index' %}">Inicio</a> /
      <a href="{% url 'catalogo' %}">CatÃ¡logo</a> /
      <a
        href="{% url 'catalogo' %}?categoria={{ producto.categoria.categoria_id }}"
      >{{ producto.categoria.nombre }}</a
        >
        / {{ producto.nombre }}
      </small>
    </div>

    <!-- Detalle del producto -->
    <div class="container my-5">
      <div class="row">
        <!-- Imagen del producto -->
        <div class="col-md-6">
          {% if producto.imagen_url %}
            <img
              src="{% static producto.imagen_url %}"
              alt="{{ producto.nombre }}"
              class="img-fluid rounded shadow"
              style="max-height: 500px; width: 100%; object-fit: contain"
            />
          {% else %}
            <div
              class="d-flex align-items-center justify-content-center bg-light rounded"
              style="height: 400px"
            >
              <span class="text-muted fs-4">Sin imagen disponible</span>
            </div>
          {% endif %}
        </div>

        <!-- InformaciÃ³n del producto -->
        <div class="col-md-6">
          <h1 class="h2">{{ producto.nombre }}</h1>
          <p class="text-muted mb-3">
            <strong>SKU:</strong> {{ producto.sku }} |
            <strong>Marca:</strong> {{ producto.marca.nombre|default:"Sin marca" }} | <strong>CategorÃ­a:</strong> {{ producto.categoria.nombre }}
          </p>

          <div class="mb-4">
            <span class="h3 text-primary fw-bold"
            >${{ producto.precio|floatformat:0 }}</span
              >
            </div>

          <!-- Stock -->
            <div class="mb-3">
              {% if producto.stock > 0 %}
                <span class="badge bg-success fs-6"
                >âœ“ En stock ({{ producto.stock }} unidades)</span
                  >
              {% else %}
                <span class="badge bg-danger fs-6">âœ— Sin stock</span>
              {% endif %}
            </div>

          <!-- DescripciÃ³n -->
            <div class="mb-4">
              <h5>DescripciÃ³n</h5>
              <p>
                {{ producto.descripcion|default:"DescripciÃ³n no disponible"|linebreaks }}
              </p>
            </div>

          <!-- Botones de acciÃ³n -->
            <div class="d-grid gap-2 d-md-block">
              {% if producto.stock > 0 %}
                <button
                  type="button"
                  class="btn btn-success btn-lg"
                  value="{{ producto.producto_id }}"
                  id="agregar-carrito"
                >
                  ðŸ›’ Agregar al carrito
                </button>
              {% else %}
                <button type="button" class="btn btn-secondary btn-lg" disabled>
                  Sin stock disponible
                </button>
              {% endif %}
              <a
                href="{% url 'catalogo' %}"
                class="btn btn-outline-primary btn-lg"
              >Seguir comprando</a
                >
              </div>
            </div>
          </div>
        </div>

{% endblock %}

{% block extra_js %}
<script>
$(document).on("click", "#agregar-carrito", function (e) {
    e.preventDefault();
    $.ajax({
        type: "POST",
        url: "{% url 'carrito:agregar_al_carrito' %}",
        data: {
          producto_id: $("#agregar-carrito").val(),
          csrfmiddlewaretoken: "{{ csrf_token }}",
          action: "post"
        },
        success: function(json){
          console.log(json);
        },
        error: function(xhr, errmsg, err){
        }
    });
});
</script>
{% endblock %}
