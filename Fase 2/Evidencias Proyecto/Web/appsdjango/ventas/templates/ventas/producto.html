{% extends "ventas/ventas_base.html" %}
{% load static %}

{% block title %}{{ producto.nombre }} - Cordillera Pets{% endblock %}

{% block content %}

    <!-- Migas de pan -->
  <div class="container mt-3">
    <small>
      <a href="{% url 'index' %}">Inicio</a> /
      <a href="{% url 'catalogo' %}">Cat√°logo</a> /
      <a
        href="{% url 'catalogo' %}?categoria={{ producto.categoria.categoria_id }}"
      >{{ producto.categoria.nombre }}</a
        >
        / {{ producto.nombre }}
      </small>
    </div>

    <!-- Detalle del producto -->
    <div class="container my-5">
      <div class="row">
        <!-- Imagen del producto -->
        <div class="col-md-6">
          {% if producto.imagen_url %}
            <img
              src="{% static producto.imagen_url %}"
              alt="{{ producto.nombre }}"
              class="img-fluid rounded shadow"
              style="max-height: 500px; width: 100%; object-fit: contain"
            />
          {% else %}
            <div
              class="d-flex align-items-center justify-content-center bg-light rounded"
              style="height: 400px"
            >
              <span class="text-muted fs-4">Sin imagen disponible</span>
            </div>
          {% endif %}
        </div>

        <!-- Informaci√≥n del producto -->
        <div class="col-md-6">
          <h1 class="h2">{{ producto.nombre }}</h1>
          <p class="text-muted mb-3">
            <strong>SKU:</strong> {{ producto.sku }} |
            <strong>Marca:</strong> {{ producto.marca.nombre|default:"Sin marca"
            }} | <strong>Categor√≠a:</strong> {{ producto.categoria.nombre }}
          </p>

          <div class="mb-4">
            <span class="h3 text-primary fw-bold"
            >${{ producto.precio|floatformat:0 }}</span
              >
            </div>

          <!-- Stock -->
            <div class="mb-3">
              {% if producto.stock > 0 %}
                <span class="badge bg-success fs-6"
                >‚úì En stock ({{ producto.stock }} unidades)</span
                  >
              {% else %}
                <span class="badge bg-danger fs-6">‚úó Sin stock</span>
              {% endif %}
            </div>

          <!-- Descripci√≥n -->
            <div class="mb-4">
              <h5>Descripci√≥n</h5>
              <p>
                {{ producto.descripcion|default:"Descripci√≥n no
                disponible"|linebreaks }}
              </p>
            </div>

          <!-- Botones de acci√≥n -->
            <div class="d-grid gap-2 d-md-block">
              {% if producto.stock > 0 %}
                <button
                  type="button"
                  class="btn btn-success btn-lg"
                  onclick="agregarAlCarrito({{ producto.producto_id }})"
                >
                  üõí Agregar al carrito
                </button>
              {% else %}
                <button type="button" class="btn btn-secondary btn-lg" disabled>
                  Sin stock disponible
                </button>
              {% endif %}
              <a
                href="{% url 'catalogo' %}"
                class="btn btn-outline-primary btn-lg"
              >Seguir comprando</a
                >
              </div>
            </div>
          </div>
        </div>

    <!-- Productos relacionados -->
        {% if productos_relacionados %}
          <div class="container my-5">
            <h4>Productos relacionados</h4>
            <div class="row">
              {% for producto_rel in productos_relacionados %}
                <div class="col-6 col-md-3 mb-4">
                  <div class="card h-100 shadow-sm">
                    {% if producto_rel.imagen_url %}
                      <img
                        src="{% static producto_rel.imagen_url %}"
                        class="card-img-top"
                        alt="{{ producto_rel.nombre }}"
                        style="height: 200px; object-fit: cover"
                      />
                    {% else %}
                      <div
                        class="card-img-top d-flex align-items-center justify-content-center bg-light"
                        style="height: 200px"
                      >
                        <span class="text-muted">Sin imagen</span>
                      </div>
                    {% endif %}
                    <div class="card-body text-center">
                      <h6 class="card-title">
                        {{ producto_rel.nombre|truncatechars:30 }}
                      </h6>
                      <p class="text-primary fw-bold">
                        ${{ producto_rel.precio|floatformat:0 }}
                      </p>
                      <a
                        href="{% url 'producto_detalle' producto_rel.producto_id %}"
                        class="btn btn-sm btn-outline-primary me-1"
                      >Ver</a
                        >
                        <a
                          href="{% url 'carrito' %}?add={{ producto_rel.producto_id }}"
                          class="btn btn-sm btn-success"
                        >Agregar</a
                          >
                        </div>
                      </div>
                    </div>
              {% endfor %}
            </div>
          </div>
        {% endif %}

{% endblock %}

{% block extra_js %}
  <script>
    function agregarAlCarrito(productoId) {
    // Aqu√≠ puedes implementar la l√≥gica AJAX para agregar al carrito
    // Por ahora, redirigimos al carrito con el ID del producto
      window.location.href = "{% url 'carrito' %}?add=" + productoId;
    }
  </script>
{% endblock %}
